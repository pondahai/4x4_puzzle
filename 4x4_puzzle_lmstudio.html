<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4x4 Number Puzzle</title>
<style>
  .puzzle-container {
    display: grid;
    grid-template-columns: repeat(4, 100px);
    grid-gap: 5px;
    margin: auto;
    width: 520px;
  }
  .puzzle-piece {
    width: 100px;
    height: 100px;
    border: 1px solid #000;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
  }
  .puzzle-piece.empty {
    background-color: #f0f0f0;
  }
</style>
</head>
<body>

<div class="puzzle-container" id="puzzle">
  <!-- Puzzle pieces will be generated by JavaScript -->
</div>

<script>
const puzzleSize = 4;
let puzzle = [];
let emptyIndex = puzzleSize * puzzleSize - 1;

function createPuzzle() {
  for (let i = 0; i < puzzleSize * puzzleSize; i++) {
    if (i === emptyIndex) {
      puzzle.push('');
      continue;
    }
    puzzle.push(i + 1);
  }
  shufflePuzzle();
}

function shufflePuzzle() {
  for (let i = puzzle.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [puzzle[i], puzzle[j]] = [puzzle[j], puzzle[i]];
  }
}

function renderPuzzle() {
  const container = document.getElementById('puzzle');
  container.innerHTML = '';
  for (let i = 0; i < puzzle.length; i++) {
    const piece = document.createElement('div');
    piece.className = 'puzzle-piece';
    if (puzzle[i] !== '') {
      piece.textContent = puzzle[i];
    } else {
      piece.classList.add('empty');
      emptyIndex = i;
    }
    piece.addEventListener('click', () => movePiece(i));
    container.appendChild(piece);
  }
}

function movePiece(index) {
  const rowDiff = Math.floor(index / puzzleSize) - Math.floor(emptyIndex / puzzleSize);
  const colDiff = index % puzzleSize - emptyIndex % puzzleSize;
  if (Math.abs(rowDiff) + Math.abs(colDiff) !== 1) return;

  [puzzle[index], puzzle[emptyIndex]] = [puzzle[emptyIndex], puzzle[index]];
  renderPuzzle();
}

function handleKeyPress(event) {
  const key = event.key;
  const row = Math.floor(emptyIndex / puzzleSize);
  const col = emptyIndex % puzzleSize;

  if (key === 'ArrowUp' && row < puzzleSize - 1) {
    movePiece(emptyIndex + puzzleSize);
  } else if (key === 'ArrowDown' && row > 0) {
    movePiece(emptyIndex - puzzleSize);
  } else if (key === 'ArrowLeft' && col < puzzleSize - 1) {
    movePiece(emptyIndex + 1);
  } else if (key === 'ArrowRight' && col > 0) {
    movePiece(emptyIndex - 1);
  }
}

document.addEventListener('keydown', handleKeyPress);

createPuzzle();
renderPuzzle();
</script>

</body>
</html>
